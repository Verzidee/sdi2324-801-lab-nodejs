<div id="widget-editar">
    <div class="form-group">
        <label class="control-label col-sm-2" for="title">Nombre:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" name="title"
                   placeholder="Título de la canción" id="title"/>
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-sm-2" for="kind">Género:</label>
        <div class="col-sm-10">
            <input type="text" class="form-control" name="kind"
                   placeholder="Género de la canción" id="kind"/>
        </div>
    </div>
    <div class="form-group">
        <label class="control-label col-sm-2" for="price">Precio (€):</label>
        <div class="col-sm-10">
            <input type="number" step="0.01" class="form-control" name="price"
                   placeholder="Precio de la canción" id="price"/>
        </div>
    </div>
    <button onclick="updateSong()" class="btn btn-primary" >Guardar Cambios</button>
    <button onclick="widgetSongs()" class="btn" >Volver</button>
</div>
<script>
    $(document).ready(function() {
        // Cargar los datos existentes de la canción para editar
        $.ajax({
            url: URLbase + "/songs/" + selectedSongId,
            type: "GET",
            dataType: 'json',
            headers: {
                "token": token
            },
            success: function (response) {
                $("#title").val(response.song.title);
                $("#kind").val(response.song.kind);
                $("#price").val(response.song.price);
            },
            error: function (error) {
                $("#main-container").load("widget-login.html");
            }
        });
    });

    function updateSong() {
        var songData = {
            title: $('#title').val(),
            kind: $('#kind').val(),
            price: $('#price').val()
        };

        $.ajax({
            url: URLbase + "/songs/" + selectedSongId,
            type: "PUT",
            data: JSON.stringify(songData),
            contentType: "application/json; charset=utf-8",
            dataType: 'json',
            headers: {"token": token},
            success: function (response) {
                console.log("Canción actualizada: ", response);
                widgetSongs(); // Volver a la lista de canciones o actualizar la vista actual
            },
            error: function (response) {
                let current_errors = (typeof response.responseJSON.errors === "undefined") ? null : response.responseJSON.errors;
                if (current_errors != null && current_errors.length > 0) {
                    $("#widget-editar").prepend("<div id = 'div-errors' class='alert alert-danger'><ul id = 'ul-errors'></ul></div>");
                    $("#ul-errors").append("<li>" + current_errors + "</li>");
                } else {
                    $("#widget-editar")
                        .prepend("<div id = 'div-errors' class='alert alert-danger'>Se ha producido un error inesperado</div>");
                }
            }
        });
    }

    function widgetSongs() {
        // Cargar la vista de la lista de canciones
        $("#main-container").load("widget-songs.html");
    }
</script>
